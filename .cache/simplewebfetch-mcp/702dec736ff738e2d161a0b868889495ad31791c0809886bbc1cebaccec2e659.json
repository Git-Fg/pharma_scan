{
  "url": "https://opensource.com/article/18/8/what-how-makefile",
  "markdown": "# What is a Makefile and how does it work? | Opensource.com\n*By Sachin Patil*\n---\n[Skip to main content](#main-content)\n[![Supported by Red Hat](https://opensource.com/themes/osdc/assets/img/l_supported-by-redhat-white.svg \"Supported by Red Hat\")](https://www.redhat.com/en?intcmp=701600000011l7VAAQ)\n## User account menu\n-   [Log in](https://opensource.com/user/login?current=/article/18/8/what-how-makefile)\n-   [RSS](https://opensource.com/feed \"RSS\")\n [![Home](https://opensource.com/themes/osdc/logo.svg)](https://opensource.com/)[![Supported by Red Hat](https://opensource.com/themes/osdc/assets/img/l_supported-by-redhat-white.svg)](https://www.redhat.com/en?intcmp=701600000011l7VAAQ)\n## Main navigation\n-   [Articles](https://opensource.com/)\n-   [Resources](https://opensource.com/resources)\n    -   [What is open source?](https://opensource.com/resources/what-open-source)\n        -   [The open source way](https://opensource.com/open-source-way)\n    -   [Projects and applications](https://opensource.com/resources/projects-and-applications)\n    -   [Organizations](https://opensource.com/resources/organizations)\n    -   [Open source alternatives](https://opensource.com/alternatives)\n        -   [Alternatives to Acrobat](https://opensource.com/alternatives/adobe-acrobat)\n        -   [Alternatives to AutoCAD](https://opensource.com/alternatives/autocad)\n        -   [Alternatives to Dreamweaver](https://opensource.com/alternatives/dreamweaver)\n        -   [Alternatives to Gmail](https://opensource.com/alternatives/gmail)\n        -   [Alternatives to MATLAB](https://opensource.com/alternatives/matlab)\n        -   [Alternatives to Minecraft](https://opensource.com/alternatives/minecraft)\n        -   [Alternatives to Google Photos](https://opensource.com/alternatives/google-photos)\n        -   [Alternatives to Photoshop](https://opensource.com/life/12/6/design-without-debt-five-tools-for-designers)\n        -   [Alternatives to Skype](https://opensource.com/alternatives/skype)\n        -   [Alternatives to Slack](https://opensource.com/alternatives/slack)\n        -   [Alternatives to Trello](https://opensource.com/alternatives/trello)\n        -   [More...](https://opensource.com/alternatives)\n    -   [Linux](https://opensource.com/resources/linux)\n-   [Downloads](https://opensource.com/downloads)\n-   [Frequently Asked Questions](https://opensource.com/faq)\nSearch\n# What is a Makefile and how does it work?\nRun and compile your programs more efficiently with this handy automation tool.\nBy\n[Sachin Patil](https://opensource.com/users/psachin)\nAugust 22, 2018 | [8 Comments](#comments) | %t min read\n638 readers like this.\n![Open Data Policy](https://opensource.com/sites/default/files/lead-images/osdc_liberate%20docs_1109ay.png \"new open data guidelines available\")\nImage by:\nOpensource.com\nIf you want to run or update a task when certain files are updated, the `make` utility can come in handy. The `make` utility requires a file, `Makefile` (or `makefile`), which defines set of tasks to be executed. You may have used `make` to compile a program from source code. Most open source projects use `make` to compile a final executable binary, which can then be installed using `make install`.\nIn this article, we'll explore `make` and `Makefile` using basic and advanced examples. Before you start, ensure that `make` is installed in your system.\n## Basic examples\nLet's start by printing the classic \"Hello World\" on the terminal. Create a empty directory `myproject` containing a file `Makefile` with this content:\n```bash\nsay_hello:\n        echo \"Hello World\"\n```\nNow run the file by typing `make` inside the directory `myproject`. The output will be:\n```bash\n$ make\necho \"Hello World\"\nHello World\n```\nIn the example above, `say_hello` behaves like a function name, as in any programming language. This is called the _target_. The _prerequisites_ or _dependencies_ follow the target. For the sake of simplicity, we have not defined any prerequisites in this example. The command `echo \"Hello World\"` is called the _recipe_. The _recipe_ uses _prerequisites_ to make a _target_. The target, prerequisites, and recipes together make a _rule_.\nTo summarize, below is the syntax of a typical rule:\n```bash\ntarget: prerequisites\n<TAB> recipe\n```\nAs an example, a target might be a binary file that depends on prerequisites (source files). On the other hand, a prerequisite can also be a target that depends on other dependencies:\n```bash\nfinal_target: sub_target final_target.c\n\tRecipe_to_create_final_target\nsub_target: sub_target.c\n\tRecipe_to_create_sub_target\n```\nIt is not necessary for the target to be a file; it could be just a name for the recipe, as in our example. We call these \"phony targets.\"\nGoing back to the example above, when `make` was executed, the entire command `echo \"Hello World\"` was displayed, followed by actual command output. We often don't want that. To suppress echoing the actual command, we need to start `echo` with `@`:\n```bash\nsay_hello:\n        @echo \"Hello World\"\n```\nNow try to run `make` again. The output should display only this:\n```bash\n$ make\nHello World\n```\nLet's add a few more phony targets: `generate` and `clean` to the `Makefile`:\n```bash\nsay_hello:\n        @echo \"Hello World\"\ngenerate:\n\t@echo \"Creating empty text files...\"\n\ttouch file-{1..10}.txt\nclean:\n\t@echo \"Cleaning up...\"\n\trm *.txt\n```\nIf we try to run `make` after the changes, only the target `say_hello` will be executed. That's because only the first target in the makefile is the default target. Often called the _default goal_, this is the reason you will see `all` as the first target in most projects. It is the responsibility of `all` to call other targets. We can override this behavior using a special phony target called `.DEFAULT_GOAL`.\nLet's include that at the beginning of our makefile:\n```bash\n.DEFAULT_GOAL := generate\n```\nThis will run the target `generate` as the default:\n```bash\n$ make\nCreating empty text files...\ntouch file-{1..10}.txt\n```\nAs the name suggests, the phony target `.DEFAULT_GOAL` can run only one target at a time. This is why most makefiles include `all` as a target that can call as many targets as needed.\nLet's include the phony target `all` and remove `.DEFAULT_GOAL`:\n```bash\nall: say_hello generate\nsay_hello:\n\t@echo \"Hello World\"\ngenerate:\n\t@echo \"Creating empty text files...\"\n\ttouch file-{1..10}.txt\nclean:\n\t@echo \"Cleaning up...\"\n\trm *.txt\n```\nBefore running `make`, let's include another special phony target, `.PHONY`, where we define all the targets that are not files. `make` will run its recipe regardless of whether a file with that name exists or what its last modification time is. Here is the complete makefile:\n```bash\n.PHONY: all say_hello generate clean\nall: say_hello generate\nsay_hello:\n\t@echo \"Hello World\"\ngenerate:\n\t@echo \"Creating empty text files...\"\n\ttouch file-{1..10}.txt\nclean:\n\t@echo \"Cleaning up...\"\n\trm *.txt\n```\nThe `make` should call `say_hello` and `generate`:\n```bash\n$ make\nHello World\nCreating empty text files...\ntouch file-{1..10}.txt\n```\nIt is a good practice not to call `clean` in `all` or put it as the first target. `clean` should be called manually when cleaning is needed as a first argument to `make`:\n```bash\n$ make clean\nCleaning up...\nrm *.txt\n```\nNow that you have an idea of how a basic makefile works and how to write a simple makefile, let's look at some more advanced examples.\n## Advanced examples\n### Variables\nMore Linux resources\n-   [Linux commands cheat sheet](https://developers.redhat.com/cheat-sheets/linux-commands-cheat-sheet/?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [Advanced Linux commands cheat sheet](https://developers.redhat.com/cheat-sheets/advanced-linux-commands/?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [Free online course: RHEL Technical Overview](https://www.redhat.com/en/services/training/rh024-red-hat-linux-technical-overview?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [Linux networking cheat sheet](https://opensource.com/downloads/cheat-sheet-networking?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [SELinux cheat sheet](https://opensource.com/downloads/cheat-sheet-selinux?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [Linux common commands cheat sheet](https://opensource.com/downloads/linux-common-commands-cheat-sheet?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [What are Linux containers?](https://opensource.com/resources/what-are-linux-containers?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\n-   [Our latest Linux articles](https://opensource.com/tags/linux?intcmp=70160000000h1jYAAQ&utm_source=intcallout&utm_campaign=linuxcontent)\nIn the above example, most target and prerequisite values are hard-coded, but in real projects, these are replaced with variables and patterns.\nThe simplest way to define a variable in a makefile is to use the `=` operator. For example, to assign the command `gcc` to a variable `CC`:\n```\nCC = gcc\n```\nThis is also called a _recursive expanded variable_, and it is used in a rule as shown below:\n```bash\nhello: hello.c\n    ${CC} hello.c -o hello\n```\nAs you may have guessed, the recipe expands as below when it is passed to the terminal:\n```\ngcc hello.c -o hello\n```\nBoth `${CC}` and `$(CC)` are valid references to call `gcc`. But if one tries to reassign a variable to itself, it will cause an infinite loop. Let's verify this:\n```bash\nCC = gcc\nCC = ${CC}\nall:\n    @echo ${CC}\n```\nRunning `make` will result in:\n```bash\n$ make\nMakefile:8: *** Recursive variable 'CC' references itself (eventually).  Stop.\n```\nTo avoid this scenario, we can use the `:=` operator (this is also called the _simply expanded variable_). We should have no problem running the makefile below:\n```bash\nCC := gcc\nCC := ${CC}\nall:\n    @echo ${CC}\n```\n### Patterns and functions\nThe following makefile can compile all C programs by using variables, patterns, and functions. Let's explore it line by line:\n```text\n# Usage:\n# make        # compile all binary\n# make clean  # remove ALL binaries and objects\n.PHONY = all clean\nCC = gcc\t\t\t# compiler to use\nLINKERFLAG = -lm\nSRCS := $(wildcard *.c)\nBINS := $(SRCS:%.c=%)\nall: ${BINS}\n%: %.o\n\t@echo \"Checking..\"\n\t${CC} ${LINKERFLAG} $< -o $@\n%.o: %.c\n\t@echo \"Creating object..\"\n\t${CC} -c $<\nclean:\n\t@echo \"Cleaning up...\"\n\trm -rvf *.o ${BINS}\n```\n-   Lines starting with `#` are comments.\n-   Line `.PHONY = all clean` defines phony targets `all` and `clean`.\n-   Variable `LINKERFLAG` defines flags to be used with `gcc` in a recipe.\n-   `SRCS := $(wildcard *.c)`: `$(wildcard pattern)` is one of the _functions for filenames_. In this case, all files with the `.c` extension will be stored in a variable `SRCS`.\n-   `BINS := $(SRCS:%.c=%)`: This is called as _substitution reference_. In this case, if `SRCS` has values `'foo.c bar.c'`, `BINS` will have `'foo bar'`.\n-   Line `all: ${BINS}`: The phony target `all` calls values in`${BINS}` as individual targets.\n-   Rule:\n    ```bash\n    %: %.o\n      @echo \"Checking..\"\n      ${CC} ${LINKERFLAG} $&lt; -o $@\n    ```\n    Let's look at an example to understand this rule. Suppose `foo` is one of the values in `${BINS}`. Then `%` will match `foo`(`%` can match any target name). Below is the rule in its expanded form:\n    ```bash\n    foo: foo.o\n      @echo \"Checking..\"\n      gcc -lm foo.o -o foo\n    ```\n    As shown, `%` is replaced by `foo`. `$<` is replaced by `foo.o`. `$<` is patterned to match prerequisites and `$@` matches the target. This rule will be called for every value in `${BINS}`\n-   Rule:\n    ```bash\n    %.o: %.c\n      @echo \"Creating object..\"\n      ${CC} -c $&lt;\n    ```\n    Every prerequisite in the previous rule is considered a target for this rule. Below is the rule in its expanded form:\n    ```bash\n    foo.o: foo.c\n      @echo \"Creating object..\"\n      gcc -c foo.c\n    ```\n-   Finally, we remove all binaries and object files in target `clean`.\nBelow is the rewrite of the above makefile, assuming it is placed in the directory having a single file `foo.c:`\n```text\n# Usage:\n# make        # compile all binary\n# make clean  # remove ALL binaries and objects\n.PHONY = all clean\nCC = gcc\t\t\t# compiler to use\nLINKERFLAG = -lm\nSRCS := foo.c\nBINS := foo\nall: foo\nfoo: foo.o\n\t@echo \"Checking..\"\n\tgcc -lm foo.o -o foo\nfoo.o: foo.c\n\t@echo \"Creating object..\"\n\tgcc -c foo.c\nclean:\n\t@echo \"Cleaning up...\"\n\trm -rvf foo.o foo\n```\nFor more on makefiles, refer to the [GNU Make manual](https://www.gnu.org/software/make/manual/make.pdf), which offers a complete reference and examples.\nYou can also read our [Introduction to GNU Autotools](https://opensource.com/article/19/7/introduction-gnu-autotools) to learn how to automate the generation of a makefile for your coding project.\nWhat to read next\nTags\n[Linux](https://opensource.com/tags/linux)\n[Tools](https://opensource.com/tags/tools)\n[Sachin Patil](https://opensource.com/users/psachin)\n![psachin](https://opensource.com/sites/default/files/styles/150x150/public/pictures/intothewild.jpg?itok=gFLGsLE1)\nSachin is passionate about Free and Open source software. He is avid GNU Emacs user and likes to talk and write about open source, GNU/Linux, Git, and Python. He has previously worked on OpenStack, ManageIQ/CloudForms & Red Hat Insights. He also likes to explore Swift Object Storage in his spare time. He can be reached on IRC as psachin@{Libera.Chat, Freenode, OFTC, gnome}.\n[More about me](https://opensource.com/users/psachin)\n## 8 Comments\nThese comments are closed.\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[Kiko Fernandez-Reyes](https://opensource.com/users/kikofernandez) | August 22, 2018\nNo readers like this yet.\nHi,\nThanks for this tutorial. Really useful and easy to follow.\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[Sachin Patil](https://opensource.com/users/psachin) | August 22, 2018\nNo readers like this yet.\nGlad that you liked it. Thanks!!\nIn reply to [Hi,](#comment-161976) by [kikofernandez](https://opensource.com/users/kikofernandez \"View user profile.\")\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[Thomas](https://opensource.com/users/lalelunet) | August 23, 2018\nNo readers like this yet.\nInteresting article. It motivate me to play around with Makefiles.\nThank you\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[Sachin Patil](https://opensource.com/users/psachin) | August 24, 2018\nNo readers like this yet.\nCool!!\nIn reply to [Interesting article. It](#comment-162031) by [Thomas](https://opensource.com/users/lalelunet \"View user profile.\")\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[RogersGuedes](https://opensource.com/users/rogersguedes) | September 11, 2018\nNo readers like this yet.\nThank you so much!\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[Sachin Patil](https://opensource.com/users/psachin) | November 21, 2018\nNo readers like this yet.\n:)\nIn reply to [Thank you so much!](#comment-163361) by [RogersGuedes](https://opensource.com/users/rogersguedes \"View user profile.\")\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\nNeeraj Sharma | November 5, 2018\nNo readers like this yet.\nThank you so much...\nvery nice article...\n![Avatar](https://opensource.com/sites/default/files/styles/medium/public/osdc_default_avatar_1.png?itok=G0WcUo3c \"Avatar\")\n[Sachin Patil](https://opensource.com/users/psachin) | November 15, 2018\nNo readers like this yet.\nThanks!\nIn reply to [Thank you so much...](#comment-166161) by Neeraj Sharma (not verified)\n## Related Content\n[![GNOME](https://opensource.com/sites/default/files/styles/222x125/public/lead-images/custom_gnomes.png?itok=cERF8C4e \"GNOME\")](https://opensource.com/article/23/4/linux-gnome-44-features)\n[What's new in GNOME 44?](https://opensource.com/article/23/4/linux-gnome-44-features)\n[![Computer laptop in space](https://opensource.com/sites/default/files/styles/222x125/public/lead-images/computer_space_graphic_cosmic.png?itok=5rMxPHCU \"Computer laptop in space\")](https://opensource.com/article/23/4/5-reasons-virtual-machines-still-matter)\n[5 reasons virtual machines still matter](https://opensource.com/article/23/4/5-reasons-virtual-machines-still-matter)\n[![Painting art on a computer screen](https://opensource.com/sites/default/files/styles/222x125/public/lead-images/painting_computer_screen_art_design_creative.png?itok=QNbZrbH6 \"Painting art on a computer screen\")](https://opensource.com/article/23/4/image-editing-linux-python)\n[Remove the background from an image with this Linux command](https://opensource.com/article/23/4/image-editing-linux-python)\n[![Creative Commons License](https://opensource.com/themes/osdc/assets/img/cc-by-sa-4.png \"This work is licensed under a Creative Commons Attribution-Share Alike 4.0 International License.\")](https://creativecommons.org/licenses/by-sa/4.0/)This work is licensed under a Creative Commons Attribution-Share Alike 4.0 International License.\n## About This Site\nThe opinions expressed on this website are those of each author, not of the author's employer or of Red Hat.\n[Opensource.com](https://opensource.com/) aspires to publish all content under a [Creative Commons license](https://creativecommons.org/licenses/) but may not be able to do so in all cases. You are responsible for ensuring that you have the necessary permission to reuse any work on this site. Red Hat and the Red Hat logo are trademarks of Red Hat, LLC, registered in the United States and other countries.\nA note on advertising: Opensource.com does not sell advertising on the site or in any of its newsletters.\n[![Home](https://opensource.com/themes/osdc/logo.svg)](https://opensource.com/)\nCopyright Â©2021 Red Hat, LLC\n## Legal\n-   [Privacy Policy](https://opensource.com/privacy-policy)\n-   [Terms of use](https://opensource.com/legal)",
  "timestamp": 1770114931533,
  "title": "What is a Makefile and how does it work? | Opensource.com"
}