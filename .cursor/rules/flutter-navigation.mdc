---
alwaysApply: false
description: AutoRoute navigation patterns, router injection, and route configuration
---

# Navigation (AutoRoute 11.0.0)

## Context-Free Navigation Pattern

Navigation is decoupled from `BuildContext` by injecting the router via `routerProvider`. This treats navigation as a **Side Effect Service**.

**Architecture:**
- `appRouterProvider`: Creates the singleton `AppRouter` instance (used in `main.dart`)
- `routerProvider`: Exposes `Raw<StackRouter>` for navigation from logic layers
- `ref.router`: Convenience extension for `ref.read(routerProvider)`

## Navigation Triggering

1. **Inside UI (Widgets):**
   - ✅ Use `context.router.push(...)` / `context.router.replace(...)` directly.
   - Rationale: `BuildContext` already exposes the typed AutoRoute extensions; keeps UI simple.

2. **Inside Logic (Notifiers/Services):**
   - ✅ Use `ref.router` or `ref.read(routerProvider)`.
   - ❌ Never pass `BuildContext` to Notifiers for navigation.
   - Rationale: Decouples business logic from UI, enables testing without widget context.

## Router Provider Implementation

```dart
// lib/core/router/router_provider.dart
@Riverpod(keepAlive: true)
AppRouter appRouter(Ref ref) => AppRouter();

@Riverpod(keepAlive: true)
Raw<StackRouter> router(Ref ref) => ref.read(appRouterProvider);
```

## Notifier Navigation Example

```dart
@riverpod
class AuthNotifier extends _$AuthNotifier {
  void logout() {
    state = const AsyncData(null);
    // Navigation without Context!
    ref.router.replace(const LoginRoute());
  }
}
```

## Widget Navigation Example

```dart
ShadButton(
  onPressed: () => context.router.push(const DetailRoute()),
  child: Text(Strings.navigate),
);
```

## 2025 Update: Tab Navigation

- Do NOT use `PopScope` for tab navigation/back button handling. Let AutoRoute manage the stack natively.
- If you must intercept back, use `context.router.popForced()` (rare; see MainScreen refactor).
- See `docs/ARCHITECTURE.md` for rationale and pattern.

## Reference Implementation

- Router: `lib/core/router/app_router.dart`
- Provider: `lib/core/router/router_provider.dart`
- Extension: `lib/core/router/router_extensions.dart`
- Tab Navigation: See main screen implementation

