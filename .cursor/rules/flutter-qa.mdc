---
alwaysApply: true
---
# QA & Testing (2025 Standard)

## Quality Gate (Run Before Every Commit)

```bash
dart run build_runner build --delete-conflicting-outputs
dart fix --apply
dart analyze --fatal-infos --fatal-warnings
flutter test
```

**Auto-Fix Discipline:** If analyzer surfaces fixable warnings, run `dart fix --apply` (up to 3x) before manual review.

## Mocking Strategy

**Library:** `mocktail` exclusively (FORBIDDEN: `mockito`)

```dart
import 'package:mocktail/mocktail.dart';

class MockDatabaseService extends Mock implements DatabaseService {}

void main() {
  late MockDatabaseService database;
  
  setUp(() {
    database = MockDatabaseService();
    registerFallbackValue(const ItemSummary());
  });
  
  test('returns empty list', () async {
    when(() => database.fetchItems()).thenAnswer((_) async => []);
    // ...
  });
}
```

## Interaction Patterns

1. **Unit/Widget Tests (`test/**/*.dart`):**
   - ✅ Use direct interactions: `tester.tap()`, `tester.pump()`, `find.byType()`, `find.byKey()`, `find.text(Strings.*)`.
   - ❌ Do not create Robot/PageObject classes for widget tests (overkill for solo dev).

2. **Integration Tests (`integration_test/**/*.dart`):**
   - ✅ Use Robot Pattern (Page Objects) to encapsulate multi-step user journeys and reduce fragility.

```dart
// ✅ Integration robot example
class ExplorerRobot {
  ExplorerRobot(this.tester);
  final WidgetTester tester;
  
  Future<void> searchFor(String term) async { /* ... */ }
  void expectResultCount(int count) { /* ... */ }
}
```

## String Literals Ban

**FORBIDDEN:** String literals in `find.text()`, `find.byTooltip()`, `find.bySemanticsLabel()`

**REQUIRED:** Use `Strings.*` constants

```dart
// ❌ FORBIDDEN
expect(find.text('Search'), findsOneWidget);

// ✅ REQUIRED
import 'package:your_app/core/utils/strings.dart';
expect(find.text(Strings.search), findsOneWidget);
```

## Layout Resilience Tests

```dart
testWidgets('adapts to narrow screen', (tester) async {
  await tester.binding.setSurfaceSize(const Size(400, 800));
  await tester.pumpWidget(MyWidget());
  expect(find.byType(MyWidget), findsOneWidget);
});

testWidgets('adapts to wide screen', (tester) async {
  await tester.binding.setSurfaceSize(const Size(1000, 800));
  await tester.pumpWidget(MyWidget());
  // Verify layout changes appropriately
});
```

## Anti-Patterns

- ❌ String literals in tests (use `Strings.*`)
- ❌ `mockito` (use `mocktail`)
- ❌ Over-engineering simple tests with Robots
- ✅ Robot pattern for complex flows
- ✅ Direct finders for simple tests
- ✅ `Strings.*` for all text expectations
