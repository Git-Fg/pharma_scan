---
description: Security protocols, permission handling, and data privacy standards.
alwaysApply: true
---

# Security & Privacy Guidelines

## 1. Data Privacy & Telemetry

* **Zero Telemetry:** You must enforce the "Zero Telemetry" policy.

* **Manifests:** Ensure `firebase_analytics_collection_deactivated` and related flags remain `true` in `AndroidManifest.xml` and `Info.plist`.

* **Logging:** Never log PII (Personally Identifiable Information) or sensitive health data to `Talker` or console.

## 2. Permission Handling

* **Just-in-Time:** Request permissions (Camera) only when the user initiates the action, never at startup.

* **Explanation:** Always show a rationale UI *before* requesting the system permission if the context isn't obvious.

* **Denial Handling:** Gracefully handle permanent denial by linking to App Settings via `app_settings` package or `Geolocator.openAppSettings()` equivalent.

## 3. Secure Storage

* **Sensitive Data:** Never use `SharedPreferences` or plain Drift text columns for tokens, passwords, or secrets.

* **Implementation:** Use `flutter_secure_storage` for secrets (if added in future).

* **Local DB:** `drift` data is unencrypted by default. Do not store sensitive patient data without implementing SQLCipher.

## 4. Input Sanitization

* **Search:** Always sanitize search inputs before passing to FTS5 queries (handled via `_escapeFts5Query`).

* **Forms:** Validate all `FTextFormField` inputs.
