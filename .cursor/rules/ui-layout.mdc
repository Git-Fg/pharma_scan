---
description: Responsive design, MediaQuery optimization, and layout patterns
alwaysApply: false
---
# UI Layout & Responsive Design (2025)

## MediaQuery Optimization (Critical)

**FORBIDDEN:** `MediaQuery.of(context)` (triggers rebuild on ANY metadata change)

**REQUIRED:** Use property-specific selectors:

```dart
// ❌ BAD: Triggers rebuild on accessibility changes
final size = MediaQuery.of(context).size;

// ✅ GOOD: Rebuilds only when size changes
final size = MediaQuery.sizeOf(context);
final padding = MediaQuery.paddingOf(context);
final viewInsets = MediaQuery.viewInsetsOf(context);
final textScaler = MediaQuery.textScalerOf(context);
```

## Responsive Design (Shadcn Native)

**Mandate:** Use `ShadResponsiveBuilder` or `context.breakpoint` extension. Raw width checks FORBIDDEN.

### Preferred: ShadResponsiveBuilder

```dart
ShadResponsiveBuilder(
  builder: (context, breakpoint) {
    return switch (breakpoint) {
      ShadBreakpointTN() => const MobileView(),
      ShadBreakpointSM() => const MobileView(),
      ShadBreakpointMD() => const TabletView(),
      ShadBreakpointLG() => const DesktopView(),
      ShadBreakpointXL() => const DesktopView(),
      ShadBreakpointXXL() => const DesktopView(),
    };
  },
);
```

### Alternative: context.breakpoint Extension

```dart
final breakpoint = context.breakpoint;
if (breakpoint >= context.shadTheme.breakpoints.md) {
  return DesktopLayout();
}
return MobileLayout();
```

## Breakpoint Values

Via `ShadTheme.of(context).breakpoints` or `context.breakpoints`:

- `tn` - Tiny (0)
- `sm` - Small (640)
- `md` - Medium (768)
- `lg` - Large (1024)
- `xl` - Extra Large (1280)
- `xxl` - Extra Extra Large (1536)

## Layout Principles

**Content Owns Layout:** Each widget handles its own constraints.

- Sheets should NOT calculate keyboard padding → Form inside handles it
- Cards should NOT handle scrolling → ListView containing them handles it
- Use `showShadSheet(side: ShadSheetSide.bottom)` directly (native Shadcn)

**Exception:** Use `DraggableScrollableSheet` ONLY for drag-to-snap panels.

## Spacing (Gap Package)

- Use `Gap` for inline spacing in rows/columns; avoid `SizedBox` when it only creates space.
- For slivers, prefer `SliverGap` over wrapping `Gap` in `SliverToBoxAdapter`.
- `SizedBox` remains acceptable only when constraining a child (e.g., loader size) rather than spacing between siblings.

## Anti-Patterns

- ❌ `MediaQuery.of(context)` without property selector
- ❌ Raw `MediaQuery.sizeOf(context).width` checks for responsive design
- ❌ Parent widgets calculating child padding
- ❌ Manual sheet sizing calculations
- ✅ `ShadResponsiveBuilder` with sealed breakpoints
- ✅ `context.breakpoint` extension
- ✅ Property-specific `MediaQuery.*Of(context)` selectors

## Scaffold Protocol (The "No-Nested-Scaffold" Rule)

**Mandate:** Do not define an `appBar` in the root `MainScreen`.

- **Root Layer:** `MainScreen` contains `AutoTabsRouter` + `BottomNavigationBar` only.
- **Leaf Layer:** Each Tab Route must define its own `Scaffold` with `appBar` (if needed).
- **Reasoning:** Prevents "Double Header" visual bugs and allows feature-specific AppBars (e.g., "Clear List" action on Restock vs "Settings" on Explorer).
